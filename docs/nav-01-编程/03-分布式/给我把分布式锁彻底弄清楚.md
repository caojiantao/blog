---
title: 给我把分布式锁彻底弄清楚
permalink: "1711359409416"
date: '2024-03-25'
---

## 锁介绍

锁在编程中是一种同步机制，用于控制对共享资源的并发访问，以防止多个线程或进程同时修改同一资源，从而避免数据不一致的问题。

像之前我写过的，MySQL 中的锁 [MySQL 内功——锁](/1693750829811/)，JVM 中的锁 [synchronized 底层原理](/1695633585440/)，JDK 中的锁 [AQS 底层原理](/1695712690253/)。

今天介绍的是**分布式锁**，用于在分布式系统中同步对共享资源的访问。由于没有单一的运行时环境或内存空间，传统的锁机制无法直接应用，因此需要特殊的分布式锁实现。

## 分布式锁

其实分布式锁的概念很好理解，既然后端服务是集群式，那就找到单一的运行环境进行处理呗；

- **数据库（MySQL）**
  - 创建表，锁标识做唯一索引列，有效期列用作异常兜底
  - 加锁时往表里插入记录，遇到唯一索引冲突会阻塞等待
  - 解锁时将记录删除即可
  - 定时任务扫描有效期非法的记录

- **Redis**
  - 利用 SET NX PX 加锁，原子性 + 有效期
  - 解锁直接 DELETE 就行

- **Zookeeper**

- **ETCD**

通常线上这些组件也都不是单节点，所以得保证组件中的数据一致性。例如 Zookeeper 和 ETCD 的 CP 强一致性，Redis 是 AP 的得用到 RedLock 算法。
