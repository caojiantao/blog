---
title: ä»¤äººç€è¿·çš„å‰ç¼€æ ‘ç®—æ³•
permalink: "1717658575459"
date: '2024-06-06'
---

## è¯´æ¥è¯é•¿

![](http://media.caojiantao.site:1024/blog/fbd2764a-34c1-4e4b-9126-50f3ecc84127.webp)

å°æ—¶å€™ç©çš„ä¸€æ¬¾çº¢ç™½æœºæ¸¸æˆä¸‰å›½å¿—ï¼Œåœ¨é€‰å›ä¸»çš„æ—¶å€™ç›¸å½“äºæœ‰å¾ˆå¤šåˆ†æ”¯è·¯çº¿ï¼Œæœ€ç»ˆå¯ä»¥åˆ°è¾¾æŒ‡å®šçš„å›ä¸»ã€‚

å‰ä¸¤å¹´æœ‰æ¬¡è‡ªå·±ç ”ç©¶å­—ç¬¦ä¸²ï¼ŒæŒ‰å­—ç¬¦åˆ†å‰²æˆä¸Šé¢è¿™ç§ç»“æ„ï¼Œè¿˜å†™è¿‡ä»£ç å®ç°ã€‚æœ€è¿‘å…¬å¸æŠ€æœ¯åˆ†äº«ï¼Œå™¢å™¢åŸæ¥è¿™å«åšå‰ç¼€æ ‘å•Šï¼ğŸ˜Š

## å‰ç¼€æ ‘

å‰ç¼€æ ‘ï¼ˆTrieæ ‘ï¼‰ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­—ç¬¦ï¼Œå¤šä¸ªèŠ‚ç‚¹ç»„åˆèµ·æ¥å½¢æˆä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²ã€‚

- æ ¹èŠ‚ç‚¹ä¸åŒ…å«å­—ç¬¦ä¸²ï¼Œé™¤äº†æ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹éƒ½åªåŒ…å«ä¸€ä¸ªå­—ç¬¦ï¼›
- æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åŒ…å«çš„å­—ç¬¦éƒ½ä¸ç›¸åŒï¼›
- ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸ªå­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„å­—ç¬¦è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼›
- æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ‹¥æœ‰ç›¸åŒçš„å‰ç¼€ã€‚

å‰ç¼€æ ‘æœ‰å‡ ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ï¼›

- å­—ç¬¦ä¸²çš„å¿«é€Ÿæ£€ç´¢
- æœ€é•¿å…¬å…±å‰ç¼€

## æ„å»ºè¿‡ç¨‹

ä¾‹å¦‚æœ‰ä¸€æ‰¹è¯ï¼Œâ€œä¸­å›½äººâ€ã€â€œä¸­å›½åŠ›é‡â€ã€â€œå…±å’Œå›½â€ã€â€œä¸­å›½â€ï¼Œæœ‰å‰ç¼€æ ‘ï¼›

![](http://media.caojiantao.site:1024/blog/0897c55d-98dd-4a6e-bcbf-107abdf880da.png)

æŸ¥æ‰¾åŒ¹é…å°±æ¯”è¾ƒç®€å•äº†ï¼Œæ¯”å¦‚æœ‰ä¸€æ®µè¯ï¼šâ€œä»Šå¤©ï¼Œä¸­å›½äººæ°‘ç«™èµ·æ¥äº†ï¼â€éœ€è¦æ ¡éªŒæ˜¯å¦åŒ…å«ä¸Šè¿°è¯ã€‚ä»â€œä»Šâ€å¼€å§‹ï¼Œé€ä¸ªä¸å‰ç¼€æ ‘è¿›è¡ŒåŒ¹é…ï¼Œç›´åˆ°åŒ¹é…æˆåŠŸï¼Œä¾‹å¦‚è¿™é‡Œçš„â€œä¸­å›½â€

## æ•°æ®ç»“æ„

é€šå¸¸æ ‘å½¢ç»“æ„ï¼Œæˆ‘éƒ½ä¼šç”¨é“¾è¡¨å­˜å‚¨ã€‚ä½†è¿™é‡Œä¸ºäº†æé«˜æŸ¥æ‰¾æ•ˆç‡ï¼Œå¯ä»¥æ¢æˆ map ç»“æ„ï¼›

```json
{
    "ä¸­": {
        "å›½": {
            "åŠ›": {
                "é‡": {
                    "$end$": true
                },
                "$end$": false
            },
            "äºº": {
                "$end$": true
            },
            "$end$": true
        }
    },
    "å…±": {
        "å’Œ": {
            "å›½": {
                "$end$": true
            },
            "$end$": false
        },
        "$end$": false
    }
}
```

## å°è¯•ç‰›åˆ€

ç¼–å†™ä¸€ä¸ªæ•æ„Ÿè¯å·¥å…·ç±»ï¼Œæä¾›æ˜¯å¦å‘½ä¸­æ•æ„Ÿè¯çš„æ–¹æ³•ï¼›

```java
/**
 * æ•æ„Ÿè¯å·¥å…·ç±»
 */
public class SensitiveWordService {

    /**
     * å‰ç¼€æ ‘ map
     */
    private final Map<String, Object> map = new HashMap<>();

    /**
     * ç»“æŸæ ‡å¿—
     */
    private static final String END = "$END$";

    /**
     * æ·»åŠ æ•æ„Ÿè¯
     *
     * @param word æ•æ„Ÿè¯
     */
    public void add(String word) {
        // æ¯ä¸ªå…³é”®è¯å¼€å§‹ï¼Œéƒ½å°†å‰ç¼€ map é‡ç½®ä¸ºåˆå§‹çš„ map
        Map<String, Object> prefixMap = map;
        for (int i = 0; i < word.toCharArray().length; i++) {
            String key = String.valueOf(word.charAt(i));
            Map<String, Object> currentMap = (Map<String, Object>) prefixMap.get(key);
            if (Objects.isNull(currentMap)) {
                currentMap = new HashMap<>();
                prefixMap.put(key, currentMap);
            }
            boolean end = (boolean) currentMap.getOrDefault(END, false);
            currentMap.put(END, end || (i == word.length() - 1));
            // ç„¶åéå†çš„è¿‡ç¨‹ä¾æ¬¡åƒä¸‹è®¾ç½®å‰ç¼€ map
            prefixMap = currentMap;
        }
    }

    private boolean remove(String word, int index, Map<String, Object> prefixMap) {
        if (index >= word.length()) {
            return true;
        }
        String key = String.valueOf(word.charAt(index));
        Map<String, Object> currentMap = (Map<String, Object>) prefixMap.get(key);
        if (Objects.isNull(currentMap)) {
            return false;
        }
        boolean remove = remove(word, index + 1, currentMap);
        boolean single = currentMap.size() == 1;
        // è¯å°¾éœ€è¦å…ˆé‡ç½® END æ ‡å¿—ä½
        if (index == word.length() - 1) {
            currentMap.put(END, false);
        }
        // ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸èƒ½è¢«åˆ é™¤ï¼Œæˆ–è€…å½“å‰å­—ç¬¦è¿˜æœ‰åç¼€å­—ç¬¦ï¼Œåˆ™å½“å‰èŠ‚ç‚¹ä¸èƒ½åˆ é™¤
        if (!remove || !single) {
            return false;
        }
        prefixMap.remove(key);
        return true;
    }

    /**
     * ç§»é™¤æ•æ„Ÿè¯
     *
     * @param word æ•æ„Ÿè¯
     * @return æ˜¯å¦å®Œå…¨ç§»é™¤
     */
    public boolean remove(String word) {
        return remove(word, 0, map);
    }

    private boolean hit(String string, int index, Map<String, Object> prefixMap) {
        if (index >= string.length()) {
            return false;
        }
        String key = String.valueOf(string.charAt(index));
        Map<String, Object> currentMap = (Map<String, Object>) prefixMap.get(key);
        if (Objects.isNull(currentMap)) {
            return hit(string, index + 1, map);
        }
        boolean end = (boolean) currentMap.getOrDefault(END, false);
        if (end) {
            return true;
        }
        // æ³¨æ„è¿™é‡Œï¼Œä¼˜å…ˆç”¨ä¸‹ä¸ªå­—ç¬¦ä¸‹ä¸ªå‰ç¼€ map è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°å‘ä¸‹ç§»ä½
        return hit(string, index + 1, currentMap) || hit(string, index + 1, map);
    }

    /**
     * æ˜¯å¦å‘½ä¸­æ•æ„Ÿè¯
     *
     * @param string å¾…æ ¡éªŒæ–‡æœ¬
     * @return å‘½ä¸­ç»“æœ
     */
    public boolean hit(String string) {
        return hit(string, 0, map);
    }

    public static void main(String[] args) {
        List<String> list = Arrays.asList("ä¸­å›½", "ä¸­å›½äºº", "ä¸­å›½åŠ›é‡", "å…±å’Œå›½");
        SensitiveWordService service = new SensitiveWordService();
        list.forEach(service::add);
        System.out.println(service.map);
        service.remove("ä¸­å›½");
        System.out.println(service.map);
        System.out.println(service.hit("ä¸­å›½"));
    }
}
```

æˆ‘åœ¨ç¼–å†™è¿‡ç¨‹ä¸­æœ‰ä¸¤ä¸ªå°é—®é¢˜è€½æäº†ä¼šï¼Œä¸€ä¸ªæ˜¯ remove çš„é€»è¾‘æœ‰ç‚¹ç‚¹ç»•ï¼Œéœ€è¦é€’å½’è‡³è¯å°¾å¼€å§‹é€ä¸ªå°è¯•åˆ é™¤ï¼›å¦ä¸€ä¸ªæ˜¯ hit æ—¶æœ¬èº«å°±æ˜¯ä¸€ä¸ªå‰ç¼€æ ‘çš„é€’å½’è¿‡ç¨‹ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯å¾…åŒ¹é…æ–‡æœ¬è¯å¤´å‘è¯å°¾çš„é€’å½’è¿‡ç¨‹ã€‚

## å‚è€ƒ

- [sensitive-word](https://github.com/houbb/sensitive-word)