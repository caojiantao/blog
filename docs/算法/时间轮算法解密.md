---
title: 时间轮算法解密
---

## 业务背景

有很多业务场景需要定时或者延时执行某个任务，例如“每天 9 点给用户发送活动提醒”、“创建订单 30 分钟未支付自动取消”等。

简单点能用 JDK 中的 Timer 直接实现，由于单线程局限性可以升级为 ScheduledThreadPoolExecutor 进行任务调度。

企业级应用中还会依赖 quartz、xxl-job 等第三方框架来高效管理定时任务。

## 什么是时间轮

时间轮是一种实现高效定时器的数据结构。其原理与时钟类似，将时间划分成多个槽（slot），每个槽代表时间精度（tickMs）并维护一个定时任务列表。另外有一个时针指向当前槽（currentSlot），并以固定的速度移动（tick）。

当时针移动到某个槽时，就遍历当前槽内的任务，执行已到期的任务。通常任务列表是基于优先级队列实现的，按照任务的执行时间排序。

![](http://image.caojiantao.site:38080/84bbd136-a8df-43d6-98a9-3b0a986cc0b9.jpg)

相比传统的定时器，基于数组+优先级队列的时间轮在处理大量任务时显得非常高效。

## 多级时间轮

## Java 实践
